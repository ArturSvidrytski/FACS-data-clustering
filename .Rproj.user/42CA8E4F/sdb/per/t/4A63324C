{
    "collab_server" : "",
    "contents" : "# Data import -------------------------------------------------------------\n\npath <- 'D:/1_Work/PROJECTS/Side_projects/FACS/Raw_Data'\nexperiment.paths <- dir( path, full.names = T)\nfiles <- dir(path = path, full.names = T )\nannex.data <- read.csv(file = files[10])\nannex.data <- read.csv(file = files[15])\n\n# First visualization -----------------------------------------------------\n\n\n\nplot( annex.data$GRN.HLin,  annex.data$RED.HLin )\nplot( annex.data$GRN.HLog,  annex.data$RED.HLog )\nplot( annex.data$FSC.HLin,  annex.data$SSC.HLin )\n\n\n\n# Hierarchcal clustering ------------------------------------------------\n\n\ncl.methods <- c( #'ward.D2'\n                  'average' )\n\nfor( i in 1:length(experiment.paths) ){\n  \n  cur.exper.path <- experiment.paths[i]\n  \n  files <- dir(path = cur.exper.path, full.names = T)\n  \n  cur.fig.path <- paste(sep = '/'\n                        , 'figures'\n                        , paste0( sprintf('%03d', i)\n                                  , '_'\n                                  , basename(cur.exper.path) ) )\n  \n  if( dir.exists(cur.fig.path) ){\n    unlink( cur.fig.path, recursive = T )\n  }\n  \n  dir.create(cur.fig.path)\n  \n  for( file.num in 1:length(files) ){\n    #for( file.num in c(14,15,16,20,22,24,25) ){\n    print( paste0('File No.: ', file.num, ' of ', length(files) )) \n    annex.data <- read.csv(file = files[file.num])\n    \n    for( cur.cl.method in cl.methods ){\n      cl.res <- hclust(dist(x = annex.data[, c(1,2)], method = 'canberra')\n                       , method = cur.cl.method)\n      \n      tiff(filename = paste0( cur.fig.path\n                              , '/'\n                              , sprintf('%03d', file.num)\n                              , '_'\n                              , cur.cl.method\n                              , '_'\n                              , 'canberra'\n                              , '_'\n                              , '_'\n                              \n                              , '.tif'), width = 2048, height = 1024  )\n      plot( annex.data$FSC.HLin\n            ,  annex.data$SSC.HLin\n            , col = cutree(cl.res, k = 2) + 1\n            , main = paste0( 'FileNo:'\n                             , file.num\n                             , ' / '\n                             , cur.cl.method\n                             , ' / '\n                             , 'canberra'\n                             , ' / ') )\n      dev.off()\n    }\n  }\n}\n  \n\n\n# Filtering ---------------------------------------------------------------\nlibrary(tidyverse)\n\nfiltered.data.path <- 'filtered_data'\ncl.methods <- c( #'ward.D2'\n  'average' )\n\nfor( i in 1:length(experiment.paths) ){\n  cur.exper.path <- experiment.paths[i]\n  files <- dir(path = cur.exper.path, full.names = T)\n  cur.filt.data.path <- paste(sep='/'\n                              , filtered.data.path\n                              , paste0( sprintf('%03d', i)\n                                        , '_'\n                                        , basename(cur.exper.path) ))\n  if( dir.exists(cur.filt.data.path) ){\n    unlink( cur.filt.data.path, recursive = T )\n  }\n  \n  dir.create(cur.filt.data.path)\n  \n  for( file.num in 1:length(files) ){\n    #for( file.num in c(14,15,16,20,22,24,25) ){\n    print( paste0('File No.: ', file.num, ' of ', length(files) )) \n    cur.file <- files[file.num]\n    annex.data <- read.csv(file = cur.file)\n    \n    for( cur.cl.method in cl.methods ){\n      cl.res <- hclust(dist(x = annex.data[, c(1,2)], method = 'canberra')\n                       , method = cur.cl.method)\n      \n      annex.data$labels <- cutree(cl.res, k = 2)\n      \n      to.filter <- as.integer(\n        annex.data %>%\n          group_by(labels) %>%\n          summarise( avgFSC = mean(FSC.HLin)\n                     , avgSSC = mean(SSC.HLin) ) %>%\n          mutate( sum = avgFSC+avgSSC) %>%\n          top_n(n=-1, wt = sum) %>%\n          select(labels) )\n      \n      annex.data.filt <- annex.data %>%\n        filter( labels != to.filter ) %>%\n        select(-labels)\n      \n      write.csv(x = annex.data.filt\n                , file = paste(sep='/'\n                               , cur.filt.data.path\n                               , basename(cur.file))\n                , row.names = F)\n      \n\n    }\n  }\n}\n\n\n\n\n# Test --------------------------------------------------------------------\n\n\n\ndata(iris)\niris <- as.matrix(iris[,1:4])\n\n## find suitable eps parameter using a k-NN plot for k = dim + 1\n## Look for the knee!\nkNNdistplot(iris, k = 5)\nabline(h=.5, col = \"red\", lty=2)",
    "created" : 1533739101436.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4055132943",
    "id" : "4A63324C",
    "lastKnownWriteTime" : 1534700129,
    "last_content_update" : 1534700129169,
    "path" : "D:/1_Work/PROJECTS/Side_projects/RPr_Cell_Survival_Analysis/filtering.R",
    "project_path" : "filtering.R",
    "properties" : {
        "docOutlineSize" : "69.99024820912416",
        "docOutlineVisible" : "1",
        "tempName" : "Untitled2"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}